{% extends 'base.html' %}

{% block content %}
<div class="container" style="margin-top: 100px; margin-bottom: 50px;">
    <div class="glass-panel">
        <header class="table-title">
            <div>
                <h1 style="font-size: 2rem;">Symposium <span class="text-gradient">Analytics</span></h1>
                <p style="color: var(--text-secondary);">Real-time data visualization of registrations</p>
            </div>
            <div class="actions">
                <a href="{{ url_for('admin.dashboard') }}" class="btn-secondary">Back to Dashboard</a>
            </div>
        </header>

        <div class="stats-grid"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
            <div class="stat-card glass-panel" style="text-align: center; border: 1px solid var(--neon-cyan);">
                <h3 style="color: var(--neon-cyan); font-size: 2.5rem;">{{ total_regs }}</h3>
                <p style="color: var(--text-secondary); text-transform: uppercase; font-size: 0.8rem;">Total
                    Registrations</p>
            </div>
            <div class="stat-card glass-panel" style="text-align: center; border: 1px solid var(--neon-purple);">
                <h3 style="color: var(--neon-purple); font-size: 2.5rem;">{{ event_counts | length }}</h3>
                <p style="color: var(--text-secondary); text-transform: uppercase; font-size: 0.8rem;">Active Events</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <div class="chart-container glass-panel">
                <h4 style="margin-bottom: 1.5rem;">Event Participation</h4>
                <canvas id="eventChart"></canvas>
            </div>
            <div class="chart-container glass-panel">
                <h4 style="margin-bottom: 1.5rem;">Department Breakdown</h4>
                <canvas id="deptChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const eventCtx = document.getElementById('eventChart').getContext('2d');
    const deptCtx = document.getElementById('deptChart').getContext('2d');

    const eventData = {
        labels: [{% for e, c in event_counts %}"{{ e }}", {% endfor %}],
    datasets: [{
        label: 'Registrations',
        data: [{% for e, c in event_counts %}{{ c }}, {% endfor %}],
        backgroundColor: 'rgba(0, 243, 255, 0.2)',
            borderColor: 'rgba(0, 243, 255, 1)',
                borderWidth: 2
        }]
    };

    const deptData = {
        labels: [{% for d, c in dept_counts %}"{{ d }}", {% endfor %}],
    datasets: [{
        data: [{% for d, c in dept_counts %}{{ c }}, {% endfor %}],
        backgroundColor: [
            'rgba(188, 19, 254, 0.5)',
            'rgba(0, 243, 255, 0.5)',
            'rgba(236, 72, 153, 0.5)',
            'rgba(245, 158, 11, 0.5)'
        ]
        }]
    };

    new Chart(eventCtx, { type: 'bar', data: eventData, options: { scales: { y: { beginAtZero: true } } } });
    new Chart(deptCtx, { type: 'doughnut', data: deptData });
</script>
{% endblock %}